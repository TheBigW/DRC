#!/bin/bash
BIT_DEPTH=32
SAMPLE_RATE=44100
SILENCE_LENGTH=2
TMP="/tmp"

AMPLITUDE="$1"
INPUT_HW="$2"
OUTPUT_HW="$3"
START_FREQ="$4"
END_FREQ="$5"
DURATION="$6"
IMP_OUT_FILE="$7"
REC_CHANNEL="$8"
SEPARATE_CHANNEL="${9}"
MEASURE_LOOPS="${10}"
PLUGIN_PATH=`dirname $0`

messurescript=${PLUGIN_PATH}"/measure"
#echo params $AMPLITUDE $INPUT_HW $OUTPUT_HW $START_FREQ $END_FREQ $DURATION $IMP_OUT_FILE $PLUGIN_PATH
echo "\n\n executing" $messurescript $BIT_DEPTH $SAMPLE_RATE $START_FREQ $END_FREQ $DURATION $SILENCE_LENGTH $INPUT_HW $OUTPUT_HW ${IMP_OUT_FILE} $AMPLITUDE $REC_CHANNEL $SEPARATE_CHANNEL $MEASURE_LOOPS"\n\n"

if [ "$SEPARATE_CHANNEL" == "False" ]; then
    bash $messurescript $BIT_DEPTH $SAMPLE_RATE $START_FREQ $END_FREQ $DURATION $SILENCE_LENGTH $INPUT_HW $OUTPUT_HW $IMP_OUT_FILE $AMPLITUDE $REC_CHANNEL $MEASURE_LOOPS
else
    bash $messurescript $BIT_DEPTH $SAMPLE_RATE $START_FREQ $END_FREQ $DURATION $SILENCE_LENGTH $INPUT_HW $OUTPUT_HW "${TMP}/imp_l.wav" $AMPLITUDE $REC_CHANNEL $MEASURE_LOOPS l
    bash $messurescript $BIT_DEPTH $SAMPLE_RATE $START_FREQ $END_FREQ $DURATION $SILENCE_LENGTH $INPUT_HW $OUTPUT_HW "${TMP}/imp_r.wav" $AMPLITUDE $REC_CHANNEL $MEASURE_LOOPS r
    #combine both outputs to one file with sox
    sox -M "${TMP}/imp_l.wav" "${TMP}/imp_r.wav" ${IMP_OUT_FILE}
fi
