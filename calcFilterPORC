#!/bin/bash

# Get command line parameters

PORC="${1}"
TARGET_CURVE_FILE="${2}"
IMPULSE_FILE="${3}"
FILTER_FILE="${4}"
RATE="44100"

filename=$(basename "$IMPULSE_FILE")
extension="${filename##*.}"
echo "extension : " $extension
if [ "$extension" != "wav" ]; then
  echo "detected raw file input : doing sox conversion"
  DEST_WAV="/tmp/TmpWave.wav"
  #cleanup previous temp file if exists
  rm $DEST_WAV -f
  echo "destination wave file : " $DEST_WAV
  sox -t raw -r $RATE -c 1 -e float -b32 ${IMPULSE_FILE} -t wav -r $RATE -e float -b32 ${DEST_WAV}
  IMPULSE_FILE="$DEST_WAV"
  echo "IMPULSE_FILE : " $IMPULSE_FILE
fi

#going with flat target curve. param -t allows for target curve. e.g -t tact30f.txt
#filter length 65535 : same as DRC
echo "calculating filters"
python $PORC --mixed  -n 65535 -o bin -t "${TARGET_CURVE_FILE}" $IMPULSE_FILE $FILTER_FILE

